<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Calculadora Completa de Galpão</title>

<style>
body{
    font-family: Arial;
    background:#f2f2f2;
    text-align:center;
}

.container{
    background:white;
    width:1000px;
    margin:20px auto;
    padding:20px;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}

input{
    width:120px;
    padding:5px;
    margin:5px;
}

button{
    padding:10px 20px;
    margin:5px;
    cursor:pointer;
    background:#007bff;
    color:white;
    border:none;
    border-radius:5px;
}

.aba{ display:none; }
.ativa{ display:block; }

#desenho{
    margin-top:20px;
    border:2px solid #333;
    position:relative;
    display:inline-block;
    background:#e9e9e9;
}

.ponto{
    width:16px;
    height:16px;
    border-radius:50%;
    position:absolute;
    transform:translate(-50%,-50%);
    cursor:pointer;
}

.ativo{ background:red; }
.inativo{ background:#ccc; }

.resultado{
    margin-top:20px;
    font-weight:bold;
}

canvas{
    margin-top:20px;
    border:2px solid #333;
    background:#fafafa;
}
</style>
</head>

<body>

<div class="container">

<h2>Calculadora Estrutural de Galpão</h2>

<button onclick="mudarAba('pilares')">Pilares</button>
<button onclick="mudarAba('tesoura')">Tesoura + Cobertura</button>

<!-- ================== ABA PILARES ================== -->
<div id="pilares" class="aba ativa">

Largura (m): <input type="number" id="largura"><br>
Comprimento (m): <input type="number" id="comprimento"><br>
Altura (m): <input type="number" id="altura"><br>
Espaçamento entre pilares (m): <input type="number" id="metros"><br>

<label>
<input type="checkbox" id="semMeio">
Não colocar pilares internos
</label>

<br>
<button onclick="gerar()">Gerar Pilares</button>

<div class="resultado" id="resultado"></div>
<div id="desenho"></div>

</div>

<!-- ================== ABA TESOURA ================== -->
<div id="tesoura" class="aba">

Inclinação do telhado (%): 
<input type="number" id="inclinacao" value="10"><br>

Comprimento da Telha (m):
<input type="number" id="compTelha" value="6"><br>

Largura útil da Telha (m):
<input type="number" id="largTelha" value="1"><br>

Espaçamento entre Terças (m):
<input type="number" id="espTerca" value="1.5"><br>

<button onclick="calcularTesoura()">Calcular Estrutura</button>

<div class="resultado" id="resultadoTesoura"></div>
<canvas id="desenhoTesoura" width="700" height="350"></canvas>

</div>

</div>

<script>

let alturaGlobal = 0;

function mudarAba(id){
    document.querySelectorAll(".aba").forEach(a=>a.classList.remove("ativa"));
    document.getElementById(id).classList.add("ativa");
}

/* ================== PILARES ================== */

function gerar(){

    let largura = parseFloat(document.getElementById("largura").value);
    let comprimento = parseFloat(document.getElementById("comprimento").value);
    let altura = parseFloat(document.getElementById("altura").value);
    let metros = parseFloat(document.getElementById("metros").value);
    let semMeio = document.getElementById("semMeio").checked;

    if(!largura || !comprimento || !altura || !metros){
        alert("Preencha todos os campos!");
        return;
    }

    alturaGlobal = altura;

    let pl = Math.floor(largura / metros) + 1;
    let pc = Math.floor(comprimento / metros) + 1;

    desenhar(largura, comprimento, pl, pc, semMeio);
}

function desenhar(largura, comprimento, pl, pc, semMeio){

    let desenho = document.getElementById("desenho");
    desenho.innerHTML = "";

    let escala = 25;
    desenho.style.width = (largura * escala) + "px";
    desenho.style.height = (comprimento * escala) + "px";

    let espacX = (largura * escala) / (pl - 1);
    let espacY = (comprimento * escala) / (pc - 1);

    for(let i=0;i<pl;i++){
        for(let j=0;j<pc;j++){

            let borda = (i==0 || i==pl-1 || j==0 || j==pc-1);

            let ponto = document.createElement("div");
            ponto.classList.add("ponto");

            ponto.style.left = (i*espacX)+"px";
            ponto.style.top = (j*espacY)+"px";

            if(semMeio){
                ponto.classList.add(borda ? "ativo" : "inativo");
            }else{
                ponto.classList.add("ativo");
            }

            ponto.onclick = function(){
                ponto.classList.toggle("ativo");
                ponto.classList.toggle("inativo");
                atualizarResultado();
            }

            desenho.appendChild(ponto);
        }
    }

    atualizarResultado();
}

function atualizarResultado(){
    let ativos = document.querySelectorAll(".ativo").length;
    let metrosColunas = ativos * alturaGlobal;

    document.getElementById("resultado").innerHTML =
        `Total de Colunas: ${ativos}<br>
         Metros Totais de Colunas: ${metrosColunas.toFixed(2)} m`;
}

/* ================== TESOURA + COBERTURA ================== */

function calcularTesoura(){

    let largura = parseFloat(document.getElementById("largura").value);
    let comprimento = parseFloat(document.getElementById("comprimento").value);
    let metros = parseFloat(document.getElementById("metros").value);
    let inclinacao = parseFloat(document.getElementById("inclinacao").value);
    let compTelha = parseFloat(document.getElementById("compTelha").value);
    let largTelha = parseFloat(document.getElementById("largTelha").value);
    let espTerca = parseFloat(document.getElementById("espTerca").value);

    if(!largura || !comprimento || !metros){
        alert("Preencha os dados na aba pilares primeiro!");
        return;
    }

    /* TESOURAS */
    let qtdTesouras = Math.floor(comprimento / metros) + 1;
    let meio = largura / 2;
    let alturaCumeeira = (inclinacao/100) * meio;
    let compAgua = Math.sqrt(meio**2 + alturaCumeeira**2);

    /* TELHAS */
    let areaTelhado = comprimento * (2 * compAgua);
    let areaTelha = compTelha * largTelha;
    let qtdTelhas = Math.ceil(areaTelhado / areaTelha);

    /* TERÇAS */
    let linhasTercas = Math.ceil(compAgua / espTerca) + 1;
    let totalTercas = linhasTercas * 2;
    let compTotalTercas = totalTercas * comprimento;

    /* CALHAS */
    let qtdCalhas = 2;
    let compCalhas = 2 * comprimento;

    document.getElementById("resultadoTesoura").innerHTML = `
        <b>TESOURAS</b><br>
        Quantidade: ${qtdTesouras}<br>
        Altura Cumeeira: ${alturaCumeeira.toFixed(2)} m<br><br>

        <b>TELHAS</b><br>
        Área Total: ${areaTelhado.toFixed(2)} m²<br>
        Quantidade: ${qtdTelhas}<br><br>

        <b>TERÇAS</b><br>
        Linhas por água: ${linhasTercas}<br>
        Total de peças: ${totalTercas}<br>
        Comprimento total: ${compTotalTercas.toFixed(2)} m<br><br>

        <b>CALHAS</b><br>
        Quantidade: ${qtdCalhas}<br>
        Comprimento total: ${compCalhas.toFixed(2)} m
    `;

    desenharTesoura(largura, alturaCumeeira);
}

function desenharTesoura(largura, altura){

    let canvas = document.getElementById("desenhoTesoura");
    let ctx = canvas.getContext("2d");
    ctx.clearRect(0,0,canvas.width,canvas.height);

    let escala = 35;
    let base = largura * escala;
    let alt = altura * escala;

    let inicioX = (canvas.width - base)/2;
    let baseY = canvas.height - 50;

    ctx.beginPath();
    ctx.moveTo(inicioX, baseY);
    ctx.lineTo(inicioX + base/2, baseY - alt);
    ctx.lineTo(inicioX + base, baseY);
    ctx.closePath();
    ctx.stroke();
}

</script>

</body>
</html>
