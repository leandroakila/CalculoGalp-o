<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>SteelCalc Pro - 3D & Treliças Paralelas</title>
    <style>
        :root { --primary: #1f2d3d; --accent: #e67e22; --bg: #f2f4f8; }
        body { font-family: 'Segoe UI', Arial; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { display: flex; gap: 20px; max-width: 1600px; margin: auto; align-items: flex-start; }
        
        /* Painel Lateral */
        .painel { width: 380px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; position: sticky; top: 20px; }
        .tab-nav { display: flex; background: var(--primary); }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; color: #fff; cursor: pointer; font-size: 10px; font-weight: bold; opacity: 0.6; }
        .tab-btn.active { opacity: 1; border-bottom: 3px solid var(--accent); }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }

        label { font-size: 11px; font-weight: bold; display: block; margin-top: 12px; color: #666; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn-acao { background: #e74c3c; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 15px; font-weight: bold; }

        /* Área de Visualização */
        .visualizacao { flex: 1; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 85vh; }
        #desenhoPlanta { position: relative; border: 1px solid #ccc; background: #fafafa; margin: 40px auto; transition: transform 0.5s; }
        
        /* Efeito 3D para a planta se desejar */
        .visao-3d { transform: rotateX(45deg) rotateZ(-30deg); box-shadow: 20px 20px 50px rgba(0,0,0,0.2); }

        .ponto { width: 16px; height: 16px; position: absolute; transform: translate(-50%,-50%); cursor: pointer; border: 1px solid #000; border-radius: 2px; z-index: 5; }
        .ativo { background: #2ecc71; box-shadow: 0 0 8px #2ecc71; }
        .inativo { background: #dfe6e9; border: 1px dashed #999; opacity: 0.4; }

        .cota-h, .cota-v { position: absolute; font-size: 10px; font-weight: bold; color: #555; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .cota-h { border-left: 1px solid #999; border-right: 1px solid #999; border-bottom: 1px solid #999; bottom: -25px; height: 8px; }
        .cota-v { border-top: 1px solid #999; border-bottom: 1px solid #999; border-left: 1px solid #999; left: -45px; width: 8px; }

        canvas { background: #1a1a1a; border-radius: 8px; max-width: 100%; border: 4px solid #333; }

        .painel-consumo { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .grade-consumo { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .card-consumo { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <div class="painel">
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab(0)">1. GEOMETRIA</button>
            <button class="tab-btn" onclick="switchTab(1)">2. ESTRUTURA</button>
            <button class="tab-btn" onclick="switchTab(2)">3. PREÇOS</button>
            <button class="tab-btn" onclick="switchTab(3)">4. RESUMO</button>
        </div>

        <div class="tab-content active" id="tab0">
            <h3>Geometria</h3>
            <label>Largura (m)</label>
            <input type="number" id="largura" value="15" oninput="redesenharTudo()">
            <label>Comprimento (m)</label>
            <input type="number" id="comprimento" value="30" oninput="redesenharTudo()">
            <label>Espaçamento entre Eixos (m)</label>
            <input type="number" id="distancia" value="5" oninput="redesenharTudo()">
            <button class="btn-acao" onclick="removerInternos()">Remover Colunas Internas</button>
        </div>

        <div class="tab-content" id="tab1">
            <h3>Corte Técnico</h3>
            <label>Modelo de Cobertura</label>
            <select id="forma" onchange="atualizarDesenhos()">
                <option value="duasAguas">Duas Águas (Tesoura)</option>
                <option value="umaAgua">Uma Água</option>
                <option value="arco">Arco Treliçado</option>
                <option value="paralela">Treliças Paralelas (Plano)</option>
            </select>
            <label>Altura Pé-Direito (m)</label>
            <input type="number" id="alturaPilar" value="6" oninput="atualizarDesenhos()">
            <label>Inclinação (%) / Altura Treliça (m)</label>
            <input type="number" id="inclinacao" value="15" oninput="atualizarDesenhos()">
            <label>Beiral (m)</label>
            <input type="number" id="beiral" value="0.8" step="0.1" oninput="atualizarDesenhos()">
        </div>

        <div class="tab-content" id="tab2">
            <h3>Custos</h3>
            <label>Preço Aço (R$/kg)</label><input type="number" id="precoAco" value="13.50" oninput="calcularTudo()">
            <label>BDI Operacional (%)</label><input type="number" id="bdi" value="25" oninput="calcularTudo()">
        </div>

        <div class="tab-content" id="tab3">
            <h3>Resumo Financeiro</h3>
            <div id="orcamentoFinal" style="background: var(--primary); color: white; padding: 20px; border-radius: 8px;"></div>
        </div>
    </div>

    <div class="visualizacao">
        <div id="containerPlanta">
            <h4 style="display:inline-block">Planta de Locação</h4> 
            <button onclick="toggle3D()" style="font-size:10px; margin-left:10px">Alternar Visão 3D</button>
            <div id="desenhoPlanta"></div>
        </div>

        <div id="containerCorte" style="display:none;">
            <h4>Corte Realista (Treliçamento)</h4>
            <canvas id="canvasCorte" width="800" height="450"></canvas>
        </div>

        <div class="painel-consumo">
            <h4>Levantamento de Consumo de Materiais</h4>
            <div class="grade-consumo" id="listaConsumo"></div>
        </div>
    </div>
</div>

<script>
    let pilaresOcultos = new Set();
    let is3D = false;

    function toggle3D() {
        is3D = !is3D;
        document.getElementById("desenhoPlanta").classList.toggle("visao-3d", is3D);
    }

    function switchTab(idx) {
        document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
        document.querySelectorAll('.tab-content').forEach((c, i) => c.classList.toggle('active', i === idx));
        document.getElementById("containerPlanta").style.display = (idx === 0) ? "block" : "none";
        document.getElementById("containerCorte").style.display = (idx === 1) ? "block" : "none";
        atualizarDesenhos();
    }

    function redesenharTudo() {
        pilaresOcultos.clear();
        atualizarDesenhos();
    }

    function atualizarDesenhos() {
        desenharPlanta();
        desenharCorte();
        calcularTudo();
    }

    function desenharPlanta() {
        const L = parseFloat(document.getElementById("largura").value) || 1;
        const C = parseFloat(document.getElementById("comprimento").value) || 1;
        const d = parseFloat(document.getElementById("distancia").value) || 1;
        const container = document.getElementById("desenhoPlanta");
        
        container.innerHTML = "";
        const esc = 18; 
        container.style.width = (L * esc) + "px";
        container.style.height = (C * esc) + "px";

        const vaosX = Math.round(L / d);
        const vaosY = Math.round(C / d);

        for (let j = 0; j <= vaosY; j++) {
            const posY = j * (C / vaosY) * esc;
            if (j < vaosY) {
                const cV = document.createElement("div");
                cV.className = "cota-v";
                cV.style.top = posY + "px";
                cV.style.height = ((C/vaosY) * esc) + "px";
                cV.innerHTML = `<span style="transform: rotate(-90deg)">${(C/vaosY).toFixed(2)}m</span>`;
                container.appendChild(cV);
            }
            for (let i = 0; i <= vaosX; i++) {
                const posX = i * (L / vaosX) * esc;
                const id = `p-${j}-${i}`;
                const p = document.createElement("div");
                p.className = "ponto " + (pilaresOcultos.has(id) ? "inativo" : "ativo");
                p.style.left = posX + "px";
                p.style.top = posY + "px";
                p.onclick = () => {
                    if (pilaresOcultos.has(id)) pilaresOcultos.delete(id);
                    else pilaresOcultos.add(id);
                    atualizarDesenhos();
                };
                container.appendChild(p);
            }
        }
        const cH = document.createElement("div");
        cH.className = "cota-h";
        cH.style.width = (L * esc) + "px";
        cH.innerHTML = L.toFixed(1) + "m";
        container.appendChild(cH);
    }

    function removerInternos() {
        const L = parseFloat(document.getElementById("largura").value);
        const C = parseFloat(document.getElementById("comprimento").value);
        const d = parseFloat(document.getElementById("distancia").value);
        const vaosX = Math.round(L / d);
        const vaosY = Math.round(C / d);
        for (let j = 1; j < vaosY; j++) {
            for (let i = 1; i < vaosX; i++) {
                pilaresOcultos.add(`p-${j}-${i}`);
            }
        }
        atualizarDesenhos();
    }

    function desenharCorte() {
        const canvas = document.getElementById("canvasCorte");
        const ctx = canvas.getContext("2d");
        const forma = document.getElementById("forma").value;
        const L = parseFloat(document.getElementById("largura").value) || 1;
        const H = parseFloat(document.getElementById("alturaPilar").value) || 1;
        const B = parseFloat(document.getElementById("beiral").value) || 0;
        const inc = parseFloat(document.getElementById("inclinacao").value) || 0;
        
        ctx.clearRect(0,0, canvas.width, canvas.height);
        const esc = 350 / (L + B*2 + H);
        const x0 = 100 + B*esc, yBase = 420, yTopo = yBase - (H * esc);

        // Pilares 3D (Efeito de Profundidade)
        ctx.fillStyle = "#2c3e50";
        ctx.fillRect(x0-8, yTopo, 16, H*esc); // Pilar Esq
        ctx.fillRect(x0 + L*esc - 8, yTopo, 16, H*esc); // Pilar Dir
        ctx.fillStyle = "#34495e";
        ctx.fillRect(x0-4, yTopo, 8, H*esc);

        // Treliçamento
        ctx.strokeStyle = "#e67e22"; ctx.lineWidth = 2;
        
        function desenharBanzo(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
            ctx.stroke();
            // Montantes e Diagonais
            let dist = Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));
            let passos = Math.floor(dist/30);
            for(let k=0; k<=passos; k++) {
                let px = x1 + (x2-x1)*(k/passos);
                let py = y1 + (y2-y1)*(k/passos);
                ctx.beginPath();
                ctx.moveTo(px, py); ctx.lineTo(px, py + 15); // Exemplo simples
                ctx.stroke();
            }
        }

        if(forma === "duasAguas") {
            const f = (L/2) * (inc/100);
            desenharBanzo(x0 - B*esc, yTopo, x0 + (L/2)*esc, yTopo - f*esc);
            desenharBanzo(x0 + (L/2)*esc, yTopo - f*esc, x0 + L*esc + B*esc, yTopo);
        } else if(forma === "arco") {
            ctx.beginPath();
            ctx.moveTo(x0 - B*esc, yTopo);
            ctx.quadraticCurveTo(x0 + (L/2)*esc, yTopo - (inc*10), x0 + L*esc + B*esc, yTopo);
            ctx.stroke();
        } else if(forma === "paralela") {
            const hT = inc; // Altura da treliça
            ctx.strokeRect(x0 - B*esc, yTopo - hT*esc, (L + B*2)*esc, hT*esc);
            // Internos da treliça paralela
            for(let m=0; m<L; m+=2) {
                ctx.moveTo(x0 + m*esc, yTopo); ctx.lineTo(x0 + (m+1)*esc, yTopo - hT*esc);
            }
            ctx.stroke();
        } else {
            desenharBanzo(x0 - B*esc, yTopo, x0 + L*esc + B*esc, yTopo - (L * inc/100)*esc);
        }

        // Cotas
        ctx.fillStyle = "white"; ctx.font = "bold 11px Arial";
        ctx.fillText(H + "m", x0 - 50, yBase - (H*esc)/2);
        ctx.fillText(L + "m Vão", x0 + (L*esc)/2 - 20, yTopo + 30);
    }

function calcularTudo() {

    const L = parseFloat(document.getElementById("largura").value);
    const C = parseFloat(document.getElementById("comprimento").value);
    const H = parseFloat(document.getElementById("alturaPilar").value);
    const dist = parseFloat(document.getElementById("distancia").value);
    const inc = parseFloat(document.getElementById("inclinacao").value);
    const forma = document.getElementById("forma").value;

    const precoAco = parseFloat(document.getElementById("precoAco").value) || 0;
    const bdi = 1 + (parseFloat(document.getElementById("bdi").value) / 100);

    const pilares = document.querySelectorAll(".ponto.ativo").length;

    // ===============================
    // 1️⃣ PESOS ESTRUTURAIS
    // ===============================

    const pesoPilares = pilares * (H * 25);

    const quantTrelicas = Math.round(C / dist) + 1;
    let kgMetroTrelica = 18;

    if (forma === "paralela") kgMetroTrelica = 22;
    if (forma === "arco") kgMetroTrelica = 20;

    const pesoTrelicas = quantTrelicas * (L * kgMetroTrelica);

    const linhasTerca = Math.ceil(L / 1.5);
    const comprimentoTotalTerca = linhasTerca * C;
    const pesoTercas = comprimentoTotalTerca * 8;

    const pesoTotalAco = pesoPilares + pesoTrelicas + pesoTercas;

    // ===============================
    // 2️⃣ TELHAS
    // ===============================

    const areaBase = L * C;
    const areaReal = areaBase * (1 + (inc / 100) * 0.1);
    const precoTelha = 65; // R$/m² padrão
    const totalTelha = areaReal * precoTelha;

    // ===============================
    // 3️⃣ CALHAS
    // ===============================

    const comprimentoCalha = C * 2;
    const precoCalha = 95;
    const totalCalha = comprimentoCalha * precoCalha;

    // ===============================
    // 4️⃣ FUNDAÇÃO
    // ===============================

    const volumeFundacao = pilares * 0.512;
    const precoConcreto = 450;
    const totalFundacao = volumeFundacao * precoConcreto;

    // ===============================
    // 5️⃣ CUSTO FINAL
    // ===============================

    const custoEstrutura = pesoTotalAco * precoAco;
    const subtotal = custoEstrutura + totalTelha + totalCalha + totalFundacao;
    const totalFinal = subtotal * bdi;

    // ===============================
    // UI
    // ===============================

    document.getElementById("listaConsumo").innerHTML = `
        <div class="card-consumo"><h5>Pilares</h5><p>${pilares} un</p></div>
        <div class="card-consumo"><h5>Treliças</h5><p>${quantTrelicas} un</p></div>
        <div class="card-consumo"><h5>Aço Total</h5><p>${pesoTotalAco.toFixed(0)} kg</p></div>
        <div class="card-consumo"><h5>Telhas</h5><p>${areaReal.toFixed(1)} m²</p></div>
        <div class="card-consumo"><h5>Concreto</h5><p>${volumeFundacao.toFixed(2)} m³</p></div>
    `;

    document.getElementById("orcamentoFinal").innerHTML = `
        <div style="font-size:12px; opacity:0.8">Estrutura Metálica</div>
        <div>R$ ${custoEstrutura.toLocaleString('pt-BR')}</div>

        <div style="font-size:12px; opacity:0.8; margin-top:8px;">Telhas</div>
        <div>R$ ${totalTelha.toLocaleString('pt-BR')}</div>

        <div style="font-size:12px; opacity:0.8; margin-top:8px;">Calhas</div>
        <div>R$ ${totalCalha.toLocaleString('pt-BR')}</div>

        <div style="font-size:12px; opacity:0.8; margin-top:8px;">Fundação</div>
        <div>R$ ${totalFundacao.toLocaleString('pt-BR')}</div>

        <hr style="margin:12px 0; border:1px solid rgba(255,255,255,0.2)">

        <div style="font-size:26px; font-weight:bold; color:var(--accent)">
            TOTAL R$ ${totalFinal.toLocaleString('pt-BR')}
        </div>
    `;
}
    window.onload = () => switchTab(0);
</script>
</body>
</html>
